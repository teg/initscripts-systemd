#!/bin/bash
#
# /lib/systemd/arch-persistent-settings
#

. /etc/rc.conf

# update timezone if: The timezone is set in rc.conf and the corresponding
# zoneinfo file exists
if [[ -n $TIMEZONE && -f /usr/share/zoneinfo/$TIMEZONE ]]; then
	# Note: it is probably better to delete the TIMEZONE var from your rc.conf to
	# avoid this interfering with other tools (such as the GUI tools in KDE/GNOME/...)
	# setting the timezone.
	if [[ -L /etc/localtime && ! /etc/localtime -ef /usr/share/zoneinfo/$TIMEZONE]]; then
		ln -sf "/usr/share/zoneinfo/$TIMEZONE" /etc/localtime
	else
		cp --remove-destination "/usr/share/zoneinfo/$TIMEZONE" /etc/localtime
	fi
fi

# create new module list if /etc/rc.conf has been updated since last generated
# /etc/modules-load.d/rc.conf
if [[ /etc/rc.conf -nt /etc/modules-load.d/rc.conf ]]; then
	echo "# Autogenerated by arch-persistent-settings, do not edit" > /etc/modules-load.d/rc.conf
	printf '%s\n' "${MODULES[@]}" >> /etc/modules-load.d/rc.conf
fi

# vim: set noet ts=2 sw=2:
